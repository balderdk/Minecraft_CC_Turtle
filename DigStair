-- stair_miner.lua
-- Self-contained: loads m_v6 API and digs a 2x4 stair 60 layers deep, then returns home.

-------------------------------------------------------
-- Load the API
-------------------------------------------------------
if not fs.exists("m") then
    error("Missing API file 'm'!")
end

os.loadAPI("m_v6")
local m = m_v6

-------------------------------------------------------
-- Config
-------------------------------------------------------
local L = 4                -- length per layer
local MAX_DEPTH = 60       -- number of layers to dig down

-------------------------------------------------------
-- Dig a 2-wide Ã— 4-long layer.
-- Turtle ends in the same horizontal place it began.
-------------------------------------------------------

local function digLayer()

    -------------------------
    -- Lane 1 (forward)
    -------------------------
    for i = 1, L do
        m.forward()
        turtle.digUp()
        turtle.digDown()
    end

    -------------------------
    -- Move to lane 2
    -------------------------
    m.right()
    m.forward()
    m.right()

    -------------------------
    -- Lane 2 (reverse)
    -------------------------
    for i = 1, L do
        m.forward()
        turtle.digUp()
        turtle.digDown()
    end

    -------------------------
    -- Return to lane 1 position
    -------------------------
    m.right()
    m.forward()
    m.left()
end

-------------------------------------------------------
-- Main stair miner
-------------------------------------------------------

local function digStair()
    print("Starting stair miner...")

    for depth = 1, MAX_DEPTH do
        print("Layer " .. depth .. " / " .. MAX_DEPTH)

        ---------------------------------------------------
        -- Dig the layer
        ---------------------------------------------------
        digLayer()

        ---------------------------------------------------
        -- Move 1 block forward
        ---------------------------------------------------
        m.forward()

        ---------------------------------------------------
        -- Dig down if something is there
        ---------------------------------------------------
        turtle.digDown()

        ---------------------------------------------------
        -- Move down (even into open space)
        ---------------------------------------------------
        m.down()
    end

    -------------------------------------------------------
    -- Finished: return home
    -------------------------------------------------------
    print("Returning to start...")
    m.goto(0,0,0)

    print("Stair miner complete and returned home.")
end

digStair()
